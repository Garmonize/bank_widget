# Виджет для отображения банковских операций клиента

## Описание

Этот проект представляет собой виджет для отображения данных о банковских операциях клиента, включая зашифрованные номера карт и счетов, а также обработку дат в определенном формате. Виджет маскирует данные карты и счета, чтобы улучшить безопасность, и преобразует даты в стандартный формат.

## Структура проекта

Проект состоит из четырех основных модулей:

1. **masks** - Маскирование данных пользователя:
   - Функции для маскировки номера карты и номера счета, чтобы они отображались в безопасном формате.
   - Формат маскированных данных:
     - Карта: `XXXX XX** **** XXXX`
     - Счет: `**XXXX`

2. **widget** - Основной виджет, использующий функции маскировки и работы с датами:
   - Функции для получения маскированных данных (карта или счет).
   - Функция для очистки и форматирования даты в формате `ДД.ММ.ГГГГ`.

3. **processing** - Обработка данных:
   - Функции для фильтрации и сортировки списка словарей, содержащих данные о транзакциях, на основе ключа `state` и даты.

4. **generators** - Генерация и работа с данными:
   - Фильтрация транзакций по валюте.
   - Получение описаний транзакций.
   - Генерация номеров карт в банковском формате `XXXX XXXX XXXX XXXX`.

## Установка

Чтобы установить проект и начать использовать его, выполните следующие шаги:

1. Клонируйте репозиторий:
   ```bash
   git clone git@github.com:Garmonize/bank_widget.git
   ```

## Использование

- Пример использования модуля masks:

    ```
    from masks import get_mask_card_number, get_mask_account

    card_number = "1234567890123456"
    account_number = "1234567890123456"

    print(get_mask_card_number(card_number))  # Выводит: 1234 56** **** 3456
    print(get_mask_account(account_number))  # Выводит: **3456
    ```
- Пример использования модуля widget:

    ```
    from widget import mask_account_card, get_date

    card_info = "Visa Platinum 7000 7999 1234 6361"
    date_data = "2025-01-16T12:34:56"

    print(mask_account_card(card_info))  # Выводит: Visa Platinum 7000 79** **** 6361
    print(get_date(date_data))  # Выводит: 16.01.2025

    ```
  
- Пример использования модуля processing:

    ```
    from processing import filter_by_state, sort_by_date

    raw_data = [
    {"state": "EXECUTED", "date": "2025-01-16T12:34:56", "amount": 100},
    {"state": "PENDING", "date": "2025-01-15T12:34:56", "amount": 50},
    {"state": "EXECUTED", "date": "2025-01-14T12:34:56", "amount": 200},
    ]

    # Фильтрация по состоянию
    filtered_data = filter_by_state(raw_data)
    print(filtered_data)  # Выводит только транзакции с состоянием 'EXECUTED'

    # Сортировка по дате
    sorted_data = sort_by_date(raw_data)
    print(sorted_data)  # Выводит транзакции, отсортированные по дате в убывающем порядке
    ```
  
- Пример использования модуля generators:

    ```
    from generators import filter_by_currency, transaction_descriptions, card_number_generator
    
    # Пример данных
    transactions = [
        {
            "id": 555555555,
            "state": "EXECUTED",
            "date": "2023-03-22T22:22:22.222222",
            "operationAmount": {"amount": "12345.67", "currency": {"name": "USD", "code": "USD"}},
            "description": "Пополнение счета",
            "from": "Счет 99887766554433221100",
            "to": "Счет 11223344556677889900",
        }
    ]
    
    # Фильтрация транзакций по валюте
    filtered = filter_by_currency(transactions, "USD")
    print(list(filtered))  # Список транзакций с валютой "USD"
    
    # Получение описаний транзакций
    descriptions = transaction_descriptions(transactions)
    print(list(descriptions))  # Выводит: ['Пополнение счета']
    
    # Генерация номеров карт
    card_numbers = card_number_generator(1, 3)
    print(list(card_numbers))  # Выводит: ['0000 0000 0000 0001', '0000 0000 0000 0002', '0000 0000 0000 0003']
    
    ```
## Тестирование

Проект включает тесты для каждого из основных модулей, чтобы обеспечить правильность работы функций. Тесты написаны с использованием фреймворка **pytest**.

### Модуль `masks`

1. **Тестирование функции маскировки номеров карт и счетов:**
   - Проверяется правильность маскировки номеров карт и счетов.
   - Тесты включают проверку правильного отображения только части номера, с заменой на символы `*`.

### Модуль `widget`

1. **Тестирование функций для маскировки и форматирования:**
   - Функции `mask_account_card` и `get_date` тестируются на различных входных данных, чтобы убедиться в корректности форматирования и маскировки.
   - Тесты включают проверку корректного преобразования даты и правильной маскировки карт и счетов.

### Модуль `processing`

1. **Тестирование функции фильтрации и сортировки данных:**
   - Тестируется функция `filter_by_state`, которая фильтрует транзакции по статусу.
   - Также проверяется корректность работы функции сортировки транзакций по дате в функции `sort_by_date`.

### Модуль `generators`

1. **Тестирование `filter_by_currency`:**
   - Проверка фильтрации по валюте.
   - Проверка работы с пустыми и некорректными данными.

2. **Тестирование `transaction_descriptions`:**
   - Проверка, что возвращаются правильные описания транзакций.

3. **Тестирование `card_number_generator`:**
   - Проверка генерации номеров карт в заданном диапазоне.
   - Проверка корректного форматирования номеров.

### Как запустить тесты

1. Убедитесь, что у вас установлены все зависимости (например, через Poetry).
2. Для запуска тестов выполните команду:

    ```bash
    pytest
    ```

   Все тесты будут автоматически выполнены, и результаты будут отображены в консоли.

### Пример теста:

```python
import pytest

from src.widget import get_date, mask_account_card


@pytest.mark.parametrize(
    "input_card_or_account_number, expected_masked_card_or_account_number",
    [
        ("VISA GOLD 1234567890123456", "Visa Gold 1234 56** **** 3456"),
        ("VISA PLATINUM 0987654321098765", "Visa Platinum 0987 65** **** 8765"),
        ("Maestro 7000792289606361", "Maestro 7000 79** **** 6361"),
        ("Mastercard 5437465747382938", "MasterCard 5437 46** **** 2938"),
        ("Счет 12345123451234512345", "Счет **2345"),
    ],
)
def test_mask_account_type(input_card_or_account_number: str, expected_masked_card_or_account_number: str) -> None:
    """функция тестирует корректность значении при вводе данных"""
    assert mask_account_card(input_card_or_account_number) == expected_masked_card_or_account_number
   ```

Такой подход помогает поддерживать проект в актуальном состоянии и гарантировать, что изменения не нарушат его функциональность.

## Дополнительная документация находится по [ссылке](ссылка на документацию)

